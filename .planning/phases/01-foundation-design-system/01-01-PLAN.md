---
phase: 01-foundation-design-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - next.config.ts
  - tsconfig.json
  - app/layout.tsx
  - app/page.tsx
  - app/globals.css
  - types/story.ts
  - types/store.ts
  - i18n/request.ts
  - messages/en.json
  - messages/fr.json
  - messages/uk.json
  - lib/greeting.ts
autonomous: true
requirements:
  - PWA-05
must_haves:
  truths:
    - "npm run dev starts without errors and opens a page"
    - "Headings render in Fredoka (Latin) with Comfortaa fallback for Ukrainian"
    - "Body text renders in Nunito across all languages"
    - "TypeScript types for Story, StoryPage, Character, StyleKey, ThemePreset, ColorMode, StarDensity, StarDepth, and Locale are importable from @/types/story"
    - "Store types for StoreState and StoreActions are importable from @/types/store"
    - "next-intl loads translations from messages/{locale}.json based on cookie"
    - "Three theme presets (mystical, dreamy, magical) are defined as CSS custom property overrides in globals.css"
    - "npm run build completes without errors"
  artifacts:
    - path: "types/story.ts"
      provides: "All domain types for downstream phases"
      exports: ["Story", "StoryPage", "Character", "StyleKey", "ThemePreset", "ColorMode", "StarDensity", "StarDepth", "Locale"]
    - path: "types/store.ts"
      provides: "Zustand store state and action type definitions"
      exports: ["StoreState", "StoreActions"]
    - path: "app/globals.css"
      provides: "Tailwind v4 theme with 3 presets, dark/light mode, font variables"
      contains: "@theme"
    - path: "app/layout.tsx"
      provides: "Root layout with fonts, next-intl provider, html lang attribute"
      contains: "NextIntlClientProvider"
    - path: "i18n/request.ts"
      provides: "next-intl request config reading locale from cookie"
      contains: "getRequestConfig"
    - path: "messages/en.json"
      provides: "English UI translations"
      min_lines: 10
    - path: "messages/fr.json"
      provides: "French UI translations"
      min_lines: 10
    - path: "messages/uk.json"
      provides: "Ukrainian UI translations"
      min_lines: 10
    - path: "lib/greeting.ts"
      provides: "Time-aware greeting key function"
      exports: ["getGreetingKey"]
  key_links:
    - from: "app/layout.tsx"
      to: "i18n/request.ts"
      via: "next-intl plugin in next.config.ts"
      pattern: "createNextIntlPlugin"
    - from: "app/globals.css"
      to: "app/layout.tsx"
      via: "font CSS variables from next/font/google"
      pattern: "--font-fredoka|--font-nunito|--font-comfortaa"
    - from: "app/globals.css"
      to: "types/story.ts"
      via: "theme preset names match ThemePreset type"
      pattern: "data-theme.*mystical|dreamy|magical"
---

<objective>
Scaffold the Next.js project with Tailwind v4, configure the font system (Fredoka + Nunito + Comfortaa for Ukrainian), define all TypeScript types needed by downstream phases, set up the i18n infrastructure with next-intl for 3 languages, and establish the multi-theme CSS system with 3 presets.

Purpose: Every downstream feature (store, components, pages) depends on the scaffold, types, theme CSS, fonts, and i18n being in place. This plan creates the entire foundation shell.
Output: A running Next.js app with correct fonts, i18n working, theme CSS defined, and all types importable.
</objective>

<execution_context>
@C:/Users/troman/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/troman/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-design-system/01-CONTEXT.md
@.planning/phases/01-foundation-design-system/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js project, install dependencies, and define TypeScript types</name>
  <files>
    package.json
    next.config.ts
    tsconfig.json
    types/story.ts
    types/store.ts
  </files>
  <action>
1. Scaffold the project using create-next-app:
   ```bash
   npx create-next-app@latest . --typescript --tailwind --eslint --app --turbopack --import-alias "@/*" --yes
   ```
   (Use `--yes` to accept defaults non-interactively. Running in the existing project root directory.)

2. Install Phase 1 dependencies:
   ```bash
   npm install zustand motion next-intl clsx tailwind-merge
   ```

3. Configure `next.config.ts` with the next-intl plugin:
   ```typescript
   import createNextIntlPlugin from 'next-intl/plugin';
   const withNextIntl = createNextIntlPlugin('./i18n/request.ts');
   export default withNextIntl({});
   ```

4. Create `types/story.ts` with ALL domain types needed across all phases:
   - `ThemePreset = 'mystical' | 'dreamy' | 'magical'`
   - `ColorMode = 'dark' | 'light'`
   - `StarDensity = 'sparse' | 'medium' | 'dense'`
   - `StarDepth = 'flat' | 'parallax'`
   - `StyleKey = 'watercolor' | 'pixar' | 'anime' | 'comic' | 'papercut' | 'chalk'`
   - `Locale = 'fr' | 'en' | 'uk'`
   - `Character` interface: `{ name: string; description: string; type: 'preset' | 'fiction' | 'custom_evan'; referenceImageUrl: string | null }`
   - `StoryPage` interface: `{ pageNumber: number; text: string; imagePrompt: string; imageUrl: string | null; imageFallbackGradient: string }`
   - `Story` interface: `{ title: string; hero: Character; world: string; villain: string; style: StyleKey; pages: StoryPage[]; locale: Locale; createdAt: string }`

5. Create `types/store.ts` with store state and action types:
   - `StoreState` interface containing:
     - Settings: `childName: string`, `theme: ThemePreset`, `mode: ColorMode`, `starDensity: StarDensity`, `starDepth: StarDepth`, `goldIntensity: number`
     - Story data: `story: Story | null`, `style: StyleKey`, `referenceImageUrl: string | null`
     - Transient state: `status: 'idle' | 'generating' | 'error'`, `currentImageIndex: number`, `error: string | null`
   - `StoreActions` interface containing setters for each state field plus a `reset()` action
   - Import types from `@/types/story`

6. Verify: Run `npm run dev` and confirm the dev server starts without errors. Run `npx tsc --noEmit` and confirm no type errors.
  </action>
  <verify>
    - `npm run dev` starts successfully (Turbopack dev server on port 3000)
    - `npx tsc --noEmit` exits with code 0
    - `types/story.ts` and `types/store.ts` exist and export all listed types
  </verify>
  <done>Project scaffolded with all dependencies installed, Next.js dev server runs, TypeScript types compile without errors</done>
</task>

<task type="auto">
  <name>Task 2: Configure Tailwind v4 theme system, fonts, i18n infrastructure, and root layout</name>
  <files>
    app/globals.css
    app/layout.tsx
    app/page.tsx
    i18n/request.ts
    messages/en.json
    messages/fr.json
    messages/uk.json
    lib/greeting.ts
  </files>
  <action>
1. Replace `app/globals.css` with the complete Tailwind v4 CSS-first configuration:
   - Import Tailwind: `@import "tailwindcss";`
   - Define dark mode custom variant: `@custom-variant dark (&:where([data-mode="dark"], [data-mode="dark"] *));`
   - Define `@theme { }` block with ALL design tokens:
     - Colors: `--color-bg-primary`, `--color-bg-secondary`, `--color-accent-gold`, `--color-accent-purple`, `--color-text-primary`, `--color-text-secondary`, `--color-card-bg`, `--color-glow`, `--color-sky-top`, `--color-sky-bottom`
     - Fonts: `--font-heading: var(--font-fredoka)`, `--font-body: var(--font-nunito)`
     - Radii: `--radius-card: 1rem`, `--radius-button: 0.75rem`
   - Use oklch color space for all colors (perceptually uniform). Default values = Mystical theme (deep navy, muted golds, jewel tone purples)
   - In `@layer base { }`, define theme preset overrides:
     - `[data-theme="mystical"] { }` -- same as defaults (explicit for clarity)
     - `[data-theme="dreamy"] { }` -- warmer tones, softer purples, sunset-like sky gradient
     - `[data-theme="magical"] { }` -- vibrant purples, brighter golds, deeper sky
     - `[data-mode="light"] { }` -- light backgrounds, dark text, higher opacity card bg
   - Add Ukrainian heading font fallback: `:lang(uk) { --font-heading: var(--font-comfortaa); }`
   - Add base body styles: `body { font-family: var(--font-body); }` and heading styles: `h1, h2, h3, h4, h5, h6 { font-family: var(--font-heading); }`
   - Do NOT use `tailwind.config.js` -- Tailwind v4 is CSS-first only.

2. Create `i18n/request.ts`:
   ```typescript
   import { getRequestConfig } from 'next-intl/server';
   import { cookies } from 'next/headers';

   export default getRequestConfig(async () => {
     const store = await cookies();
     const locale = store.get('locale')?.value || 'fr';
     return {
       locale,
       messages: (await import(`../messages/${locale}.json`)).default,
     };
   });
   ```

3. Create translation files `messages/en.json`, `messages/fr.json`, `messages/uk.json`:
   Each file should contain a flat-ish structure with keys for:
   - `landing.greeting.morning`, `.afternoon`, `.evening`, `.night` -- time-aware greetings with `{name}` placeholder. Use proper localized text:
     - EN: "Good morning, {name}" / "Good afternoon, {name}" / "Good evening, {name}" / "Sweet dreams, {name}"
     - FR: "Bonjour, {name}" / "Bon apres-midi, {name}" / "Bonsoir, {name}" / "Fais de beaux reves, {name}"
     - UK: Use actual Ukrainian Cyrillic characters, NOT transliteration. E.g., morning greeting in Ukrainian Cyrillic.
   - `landing.cta`: "Begin the Adventure" / "Commencer l'Aventure" / Ukrainian Cyrillic equivalent
   - `landing.subtitle`: A short magical subtitle line
   - `language.fr`: "Francais", `language.en`: "English", `language.uk`: Ukrainian name in Cyrillic
   - `common.settings`: "Settings" in each language

4. Create `lib/greeting.ts`:
   ```typescript
   export function getGreetingKey(): string {
     const hour = new Date().getHours();
     if (hour >= 5 && hour < 12) return 'landing.greeting.morning';
     if (hour >= 12 && hour < 17) return 'landing.greeting.afternoon';
     if (hour >= 17 && hour < 21) return 'landing.greeting.evening';
     return 'landing.greeting.night';
   }
   ```

5. Rewrite `app/layout.tsx`:
   - Import Fredoka, Nunito, Comfortaa from `next/font/google`
   - Fredoka: subsets `['latin', 'latin-ext', 'hebrew']`, variable `'--font-fredoka'`, weights `['300','400','500','600','700']`, display `'swap'`
   - Nunito: subsets `['latin', 'latin-ext', 'cyrillic', 'cyrillic-ext']`, variable `'--font-nunito'`, display `'swap'`
   - Comfortaa: subsets `['latin', 'cyrillic', 'cyrillic-ext']`, variable `'--font-comfortaa'`, weights `['300','400','500','600','700']`, display `'swap'`
   - Import `NextIntlClientProvider` from `next-intl`
   - Import `getMessages, getLocale` from `next-intl/server`
   - Set `<html lang={locale} data-theme="mystical" data-mode="dark" className={...font variables}>`
   - Wrap children in `<NextIntlClientProvider messages={messages}>`
   - Import `./globals.css`
   - Set metadata: title "Evan's Story Studio", description appropriate

6. Create a minimal `app/page.tsx` that renders:
   - A centered container with the app title using `font-heading` class (to verify font loading)
   - A body text paragraph using default body font (to verify Nunito)
   - Use `useTranslations('landing')` from `next-intl` to display the CTA text (to verify i18n)
   - This is a temporary landing page that Plan 02 will replace with the full language picker + title screen flow

7. Verify: `npm run dev` shows the page with correct fonts. `npm run build` completes without errors. Changing the locale cookie to 'uk' should swap the heading font to Comfortaa (visible in browser dev tools).
  </action>
  <verify>
    - `npm run dev` shows a page at localhost:3000 with Fredoka headings and Nunito body text
    - `npm run build` completes with exit code 0
    - Browser DevTools shows `--font-fredoka` applied to headings
    - `globals.css` contains `@theme`, `@custom-variant dark`, and all three `[data-theme=...]` blocks
    - `i18n/request.ts` exists and reads locale from cookie
    - All three message files exist with matching key structures
  </verify>
  <done>Tailwind v4 theme system with 3 presets configured, fonts loaded (Fredoka + Nunito + Comfortaa fallback), i18n infrastructure working with next-intl for 3 languages, root layout wired with providers, and a minimal page renders with correct typography. npm run build succeeds.</done>
</task>

</tasks>

<verification>
- `npm run dev` starts the Turbopack dev server without errors
- `npm run build` completes without errors
- `npx tsc --noEmit` shows no type errors
- Page renders at localhost:3000 with Fredoka headings and Nunito body text
- `globals.css` contains `@theme` with all design tokens and 3 theme preset overrides
- `types/story.ts` exports Story, StoryPage, Character, StyleKey, ThemePreset, ColorMode, StarDensity, StarDepth, Locale
- `types/store.ts` exports StoreState and StoreActions
- `i18n/request.ts` reads locale from cookie
- `messages/en.json`, `messages/fr.json`, `messages/uk.json` all exist with matching keys
- `:lang(uk)` rule in CSS swaps heading font to Comfortaa
</verification>

<success_criteria>
- The Next.js 16 project compiles and serves a page with the correct font system
- All TypeScript types needed by downstream phases are defined and importable
- The Tailwind v4 theme system is fully configured with 3 presets and dark/light mode
- The i18n infrastructure works end-to-end (cookie-based locale, translated strings render)
- `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-01-SUMMARY.md`
</output>
